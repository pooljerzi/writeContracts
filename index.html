<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>Claim Rewards (Rabby kompatibilnÃ­)</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body style="font-family: sans-serif; padding: 2rem;">
  <h2>Claim Rewards (Avalanche C-Chain)</h2>

  <button id="connect">ğŸ”Œ PÅ™ipojit penÄ›Å¾enku (Rabby / MetaMask)</button>
  <button id="claim" disabled>ğŸ† Claim Rewards</button>

  <pre id="log" style="background: #f5f5f5; padding: 1rem; margin-top: 1rem;"></pre>

  <script>
    const log = (msg) => {
      const pre = document.getElementById("log");
      pre.textContent += msg + "\n";
      pre.scrollTop = pre.scrollHeight;
    };

    const contractAddress = "0xaaaf3d9cdd3602d117c67d80eec37a160c8d9869";

    const abi = [
      {
        "inputs": [
          { "internalType": "address[]", "name": "_gauges", "type": "address[]" },
          { "internalType": "address[][]", "name": "_tokens", "type": "address[][]" }
        ],
        "name": "claimRewards",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      }
    ];

    let signer, contract;

    document.getElementById("connect").onclick = async () => {
      if (typeof window.ethereum === "undefined") {
        alert("âš ï¸ PenÄ›Å¾enka (napÅ™. Rabby nebo MetaMask) nebyla detekovÃ¡na.");
        return;
      }

      try {
        await window.ethereum.request({ method: "eth_requestAccounts" });

        const provider = new ethers.providers.Web3Provider(window.ethereum, "any");
        signer = provider.getSigner();
        const network = await provider.getNetwork();

        log(`ğŸŒ PÅ™ipojeno k sÃ­ti: ${network.name} (chainId: ${network.chainId})`);

        if (network.chainId !== 43114) {
          alert("âš ï¸ NepÅ™ipojeno k Avalanche C-Chain (Mainnet). PÅ™epni sÃ­Å¥ v Rabby.");
          return;
        }

        contract = new ethers.Contract(contractAddress, abi, signer);
        document.getElementById("claim").disabled = false;
        log("âœ… PenÄ›Å¾enka pÅ™ipojena. MÅ¯Å¾eÅ¡ claimnout rewards.");
      } catch (err) {
        console.error(err);
        log("âŒ Chyba pÅ™i pÅ™ipojenÃ­: " + err.message);
      }
    };

    document.getElementById("claim").onclick = async () => {
      try {
        const gauges = [
          "0x79A73c1a2F722695472E853DB82AFBF1D7947D3b"
        ];

        const tokens = [
          [
            "0xAAAB9D12A30504559b0C5a9A5977fEE4A6081c6b"
          ]
        ];

        log("ğŸ“¤ OdesÃ­lÃ¡m transakci...");
        const tx = await contract.claimRewards(gauges, tokens);
        log(`â³ ÄŒekÃ¡m na potvrzenÃ­... TX hash: ${tx.hash}`);

        const receipt = await tx.wait();
        log(`âœ… Transakce potvrzena! TX: ${receipt.transactionHash}`);
      } catch (err) {
        console.error(err);
        log(`âŒ Chyba pÅ™i volÃ¡nÃ­ contractu: ${err.message}`);
      }
    };
  </script>
</body>
</html>
